package com.github.goldy1992.mp3player.client.callbacks

import androidx.lifecycle.Observer
import androidx.viewpager2.widget.ViewPager2.OnPageChangeCallback
import com.github.goldy1992.mp3player.client.MediaControllerAdapter
import javax.inject.Inject

class TrackViewPagerChangeCallback

    @Inject
    constructor(private val mediaControllerAdapter: MediaControllerAdapter)

    : OnPageChangeCallback(), Observer<Int> {

    var isInitialised = false

    /**  */
     var currentPosition: Int = -1

    /**
     *
     * @param position
     */
    override fun onPageSelected(position: Int) {
        if (!isInitialised) {
            isInitialised = true
            return
        }

        if (position < 0 || currentPosition == position) {
            return
        }
        if (isSkipToNext(position)) {
            mediaControllerAdapter.skipToNext()
        } else if (isSkipToPrevious(position)) {
            mediaControllerAdapter.seekTo(0)
            mediaControllerAdapter.skipToPrevious()
        }
    }

    private fun isSkipToNext(position: Int): Boolean {
        return position == (currentPosition + 1)
    }

    private fun isSkipToPrevious(position: Int): Boolean {
        return position == (currentPosition - 1)
    }

    override fun on(t: Any) {
        if (t is Int) {
            currentPosition = t!!
        }
    }
}